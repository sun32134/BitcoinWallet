var Wallet=require('../Wallet');
var wallet = new Wallet('D:/wallet/wallet3.db')
var MessageHandler = require('../message/messageHandler')
var BN = require('bn.js')

function sendToAddress(){
    var btc=0.0001;
    var from="155eWnpFra3GjnFFGPfx2m3VuuV9Ro28fi";
    var to = "1CqzggZ1dwMgPW4iKHggwbLEh7pEV2rEu5";
    var numberOfUtxo = 8;

    // wallet.loadFromFile('hello world').then(()=>{
    //     wallet.discoverMsg().then(async () => {
    //         wallet.account.nextChainAddress(1);
    //         while(wallet.account.getChain(0).k < wallet.account.getChain(1).k){
    //             wallet.account.nextChainAddress(0);
    //         }
    //         const node=wallet.account.getChain(0).derive(from);
    //         const wif=node.toWIF();
    //         for(var i = 0; i < numberOfUtxo; i++){
    //             await wallet.sendToAddress(from, to, btc, wif);
    //         }
    //         // await sleep(1000);
    //     })
    // })
    wallet.loadFromFile('hello world').then(async() => {
        const node=wallet.account.getChain(0).derive(from);
        const wif=node.toWIF();
        console.log(wif)
        for(var i = 0; i < numberOfUtxo; i++){
            await wallet.sendToAddress(from, to, btc, wif);
        }
        await sleep(1000);
    })
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

const msgArray=[ '00361a2ab83ba1272499a1b9a6179bad33a63b30a0a6b99ab8acb795b92929a7',
'015c4d128c5613d0d19d8d905d111cd8594dd69a5159dd8ad614115314d40e5e',
'022829ef2986af260aa846c847098c86a8664f46cc4a8568290a09698d6d0d4d',
'03666554731446f4257383637546144374231346445484a647a65474d7249453',
'04123ab29353528192ca29bab9797a438bd30b719ba1a38b139aaac9abc1b1aa',
'0541458931498da15d19ad0929cd610ddd552930e555e4c511251151919945c9',
'06249cc6d2e0ccc2aac4848eacb0dccc72c6e282e6c2987256f0e2a6aee6ec9e',
'07686c2b68454d6f766c5873354b30734776685a352b6f4d5736506673477667',
'08323c28b3b6282c1b3b341898242ba6b0a0ad3ca21a38a0b0a6b527b4b72326',
'0918da0d13ce529a9a0bd59d53d1905e1554d30c589a105a9d918d94dc9c8d5a',
'0a6b0a4aededa84a8b49ee28256a8d494e066b2ccc4ead2ec9c649ca4c6ece09',
'0b66a696e656259717a2b56657a4a4f563959646237423547495552446672336',
'0c62a34ac2c33a99bb595ab1a1b95b0b13423341a98a638aa33a59bba2895bc1',
'0d5dc1154159ddb0e1b548d4d4ccd0d945d53d89b0d0ddbd9d411d695950bdd9',
'0e6cced0ce9ac4e686b0da686692a6e4685ec4ce92e860a864de62b072b2d460',
'0f7530634a58506173704231424677714f792f39315331704d79745873634137',
'103ca137353bb9b23322b29c2a24aa1827b73ab0a331ac2b982299b51a9a2126',
'111c921e1d5dcd50ce549c5bd2db5d1d1a155d5692155912918dcc9b1b951e99',
'124e46c5edcde68aef4ac82aee4eaaad0dce860b2b0ca8eee8a88aa94829ef4c',
'1326449494e6474423544736a4a6b37594c4a42635572524e415a66624247777',
'14220a426221b3ba4319b9b23a434992a36b7ac37a19a3717b4a52628b13c21b',
'150de91114e105c8c530c991b13921c9c1add8c1e4c998cd65292d89d1c50985',
'1668aed6c8acc294ac8696eeca90ec8898e46c629ed66860d2f494cc9056a4c2',
'17655764753957556d3759766f7a6646354f395974334b686477665a6f436846',
'1825b33829392bac332a283523983aa8a7349ba3329c2c9a2d2ba93aab20aa31',
'190d9d968cd894ce548bd1d39210995492d0d051104c13d9d35d0dcc1e509e0a',
'1a684dcaaccf0a0d29cc6a696f4e8648486a490e66ad4f0e09ef05e6298dcc8c',
'1b35637373678496a4b384b314e4e5050697335703956475255465830712b482',
'1c5bc212d2c3b2632a52234a0bd3aa515b2aaaba929991aaaac34213934a5351',
'1d41e5c8d93559a4e5e1e551e565a4d911a99911d560d94da52915e9b1d8c1b9',
'1e3064f0d6d062b28adaa6a65eb2e27288c6d4aad0e6d0aae2dcf0d0726cf286',
'1f5048616765726c5158706e66464e46304b6b502f41766367734c5151625461',
'2030a12a38bc37a8a3b79c3220b533b41823a79c1c22bcb6312ab3b7a19c3cb4',
'215851d899590c15dcd9944d8d4c1a0dd05c515e5699de9859511c9c1511dd1d',
'222aad8eccc6294a88ca6c6aea6cee864ae6092a8f2568eac70d2de6ad6e8aca',
'234445168524444426d2f4545794f696f73756d7a6731547a32545a6f746b614',
'2409a9a342132a3acb326209b3c9bacb3a4269a15b4a2a22525bbb337ad3421a',
'2525094964adb0c5152cd10da94d84e1d1c1491949594919e4cda539613de9d5',
'2670d46a9684ccccaca46268ae5ea6a29cd0d856c2decc72ecdcee70aca4f494',
'2759634a3959687432726d6e63414a547361505659546a5657545561672f4758',
'28351b2ba09ca2a6b72b98262bbd25b6a5ac1abc26292a9c3231aaad1cbd3d3b',
'291ada95941a169e12dace550d9d1ad59e1c5618591459d45b1c985a555b951a',
'2a0cea0aef4b48ec272e4d4a69c9e96a29edce2688a72daa862ec9ed6c690ce6',
'2b7766e58676e5a586d595a6f3668565661704e6b5366463066444f57634c613',
'2c3b23a27b4299c192ba532a9a3a82ab23c332834293622bbaa2d34ba9baa212',
'2d1d8560e14d45518ddd61d8ade0dcbd5955a9b5d0bcd91de521990548c5a548',
'2ee4e06ec88ee29adceace7a7a00000000000000000000000000000000000b30' ]


function testWalletBuild(){
    var from="1CqzggZ1dwMgPW4iKHggwbLEh7pEV2rEu5";
    var to = "155eWnpFra3GjnFFGPfx2m3VuuV9Ro28fi";
    var changeAddr = "1JPwWKCaWgj1j8rX2CgeTF14cBJwbcdPEn"

    wallet.loadFromFile('encryption key').then(()=>{
        wallet.discoverMsg().then(async () => {
            wallet.account.nextChainAddress(1);
            while(wallet.account.getChain(0).k < wallet.account.getChain(1).k){
                wallet.account.nextChainAddress(0);
            }
            const node=wallet.account.getChain(0).derive(from);
            const wif=node.toWIF();
            console.log(wif);
            wallet.sendMsgSecret(msgArray, from, to, changeAddr, 10, wif).then(txhash =>{
                console.log(txhash);
            })
        })
        
    })
}

function testWalletRecover(){
    var txhash = ["02000000056169d5d038b5f784db0892a333059680d52df3145c084e88a0fab4745a65a110010000006a473044022017c68095ffbc42946dedf9207a4338d8b2a4c2ae49e7fc44eaaafcdeb4f7e0db02202dfc208e9e6947af7df88c05812217128ba102460d31a27909d7a333928ee41b01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff062e94599761951917b456421ce335f8feec81441d6dd86de38a0b50f40f51a7010000006a47304402204e10e3295387144f074b2468070cca5232d2c2908989cdb65826a2da82e82b24022026be67c5b6481005e90011dc8bb3423d3b44efe8d7bb7e39dac0c504bd4613fe01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff3601a59de17b415a6a26b362d11c8b988f7f99aa3d9426a910bcfb1a46de4191010000006a4730440220012ad07d216e4a869ef3720ee9a2183968e1193a7c8ce51e4ada82364ee7c09d0220378045abe8d6b27e178b991a82195457c0e90c8672a434ddd9bad2b4725812c001210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff4bfda7f37c9754937a3ee51c33fa10b5a2921a91609c777ce6338b3469021d53010000006b483045022100c730486db1a06faa37c25c5796c00ca49f4038a6977e4fcdef18c3cbf3b8fceb02204f715c78ec1c9ede84068fe979a0d403a73ebc4e909cfd249e9f672126ba6a1601210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffffc32fbba18c86c875e042613aa057ff85c73d0c3a40c5f58dbabeaf7ca3c9fc36010000006b483045022100b28b9498d304ee6ef7f1ba1cc18c727a2d24d2c607d18ea38d246e3fed1b4f3b02204762b45c728cbb5d90212c6bf5cb96eb72b8c2d0ea715b0ba8adb24eaa49758f01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff020eb90000000000001976a91435f9f21795eb25e7987a2a01ae4c8be8a1d9ca9c88ace8030000000000001976a914bed0c9ce985514c0c0958906c19b6aca6898783788ac00000000",
                "02000000056169d5d038b5f784db0892a333059680d52df3145c084e88a0fab4745a65a110010000006b483045022100e3eaaffec8ab3967c4a2cf54059f98cc17ddd30c82ef7b24b863a4c584cc34e102202577a39b1e9dd1b81a181845440e153aa1278f46e82d4313bd7e858742f5e1fa01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff062e94599761951917b456421ce335f8feec81441d6dd86de38a0b50f40f51a7010000006b4830450221008211c2284a199b7397bbb7ee2417b415f3852dfa49e5c027e58d9dcfe962485a02206edd3b3a24c74dd7a6afc4717c8ba06af0585d70c90b15a2540f1acafdd9e01c01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff3601a59de17b415a6a26b362d11c8b988f7f99aa3d9426a910bcfb1a46de4191010000006b48304502210085f40ac3edcca8ba34dc0672a3b8320dffdf043ab324bc87c7add5399a0444af02202e0d6d8a226bef782b858310b635c1c3641ef1fc9a058677da337344d516aa1301210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff4bfda7f37c9754937a3ee51c33fa10b5a2921a91609c777ce6338b3469021d53010000006b483045022100e57b33215b62e7b0482aed76295ad46b9279384434542722c274c72f7d88a9130220206bfe06936b3ca860fee59e6936b8eccb614c2b77cd154b2b49ae6188fdd14701210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffffc32fbba18c86c875e042613aa057ff85c73d0c3a40c5f58dbabeaf7ca3c9fc36010000006b483045022100e7ce6f9fe13a6ecc4fde7e5a1665fc6e956d718929ea49f4c4cba0f34f8ff08402205489f53ab65272e8ff805e1e8057b29466a1e6c9e952c0549f6a6f387da5d99701210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff020eb90000000000001976a91435f9f21795eb25e7987a2a01ae4c8be8a1d9ca9c88ace8030000000000001976a914bed0c9ce985514c0c0958906c19b6aca6898783788ac00000000",
                "02000000056169d5d038b5f784db0892a333059680d52df3145c084e88a0fab4745a65a110010000006a473044022030d266d804c07779e88af6664b14c87e58d5cbdcb9e9b771e26226511b3d29c102204207ff472954e6a3a564f21ad6464fdcf4a55264f617e8e88b232d6cbd29997f01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff062e94599761951917b456421ce335f8feec81441d6dd86de38a0b50f40f51a7010000006a47304402200cf9605552009529d109716c207f086c59affab024bc0e6f6504a1ffd09dd9560220550174a3c4b45c0c52117ea02697658bb12baf8a591165e06b0e46117209465a01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff3601a59de17b415a6a26b362d11c8b988f7f99aa3d9426a910bcfb1a46de4191010000006a473044022051b05e4459a2cc5fdb437f730d0e94e8261d0a9550fd8aea2b977b3680327726022047613732fd87fbe1d7ebbbb474866e4169b68be982af1af3de77c76e4669951d01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff4bfda7f37c9754937a3ee51c33fa10b5a2921a91609c777ce6338b3469021d53010000006b483045022100ba19c3258a1f14919e0a9020638f0ee2c484b1f9896d00fbcdd509fcbfcdd42902200eb49f088ab578e00e3d3cd6e2ac6f8d09f489976f387411420b9d9c8592325b01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffffc32fbba18c86c875e042613aa057ff85c73d0c3a40c5f58dbabeaf7ca3c9fc360100000069463043021f532d6daba1ade5792ecabb0b257ee946db5c9d6d7f8675be1dd78fc93693a4022030009880ce438c873cc67fb087009af3cdcfc193a13be9f455b8b595ff03d6c301210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff020eb90000000000001976a91435f9f21795eb25e7987a2a01ae4c8be8a1d9ca9c88ace8030000000000001976a914bed0c9ce985514c0c0958906c19b6aca6898783788ac00000000",
                "02000000056169d5d038b5f784db0892a333059680d52df3145c084e88a0fab4745a65a110010000006a47304402200fba4a8f425c12191f433a02ecec9cee6320188d3c49640c8f05bfd77631232002207fae78be224d217ee9dad08ecf67a96205323f1b1a930ccb3c17fbe7cc7e243701210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff062e94599761951917b456421ce335f8feec81441d6dd86de38a0b50f40f51a7010000006b483045022100ca9bfce367b7d3c45c0dd99f926de0cb0e0f89bdc8343f6b7776fa6423a8cd7e0220774f8c38239769118821f8e7ccd16320e99b28919cc6890fea130764fa07046701210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff3601a59de17b415a6a26b362d11c8b988f7f99aa3d9426a910bcfb1a46de4191010000006b48304502210092ed874a47eb285368fd447ba4da24365c5b9aed9a50b01db3b7875d9536172202205075bf6aff559dd57c266b446aa8a10cf019b7841ebe0676a62d11bc1b06ccb701210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff4bfda7f37c9754937a3ee51c33fa10b5a2921a91609c777ce6338b3469021d53010000006b4830450221008535c8ed77a1297e9d0d3b2d2c9deafdca9a8a85d0cae4235d36156a4db3da200220472f9209c666803063d578f9a8fcbf33b6686ce347df2a5dc65fb5528aff33aa01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffffc32fbba18c86c875e042613aa057ff85c73d0c3a40c5f58dbabeaf7ca3c9fc36010000006b4830450221009c760ba72d6b6c0a5ad002c38598f5368b9cb128c810fa54c99ae73af9bf4a880220440af8b5bc9f46af2206784e68747db577b0bc0643f7167709ecc08c306757ee01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff020eb90000000000001976a91435f9f21795eb25e7987a2a01ae4c8be8a1d9ca9c88ace8030000000000001976a914bed0c9ce985514c0c0958906c19b6aca6898783788ac00000000",
                "02000000056169d5d038b5f784db0892a333059680d52df3145c084e88a0fab4745a65a110010000006b483045022100ba1a088338b30aa739e84dff809af845a0e6e48a0c5276ed88c7496ae0ef6c5d022027c0cde8b4f0602a8515385d7598b4147a473ab57d1f9f47d127c0bf01e1232f01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff062e94599761951917b456421ce335f8feec81441d6dd86de38a0b50f40f51a7010000006b483045022100b75e09ff89004d80d2990229c65d6fcbd663f96ea30bea86cddf19c599bf2c1902200924aebc72a9e490481e13d0d812b3d8c32eb5948b490213ddfad60172d4107e01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff3601a59de17b415a6a26b362d11c8b988f7f99aa3d9426a910bcfb1a46de4191010000006a473044022067810668dd69c579f6ee8491f563ffa6e801ecb26d74499fd1f87eb60910726602204e4d9adac949688239f2b301dcbc8757516f71cd3ded807827e93eefdf0ede1a01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff4bfda7f37c9754937a3ee51c33fa10b5a2921a91609c777ce6338b3469021d53010000006b483045022100cb9f053192becfa487322f60a63293e53827fd6b57030a9338aba371a73eec18022056659be7298aabdb190fdda98177d05b63f769c577a55a12e5c7c8c4482c7f4501210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffffc32fbba18c86c875e042613aa057ff85c73d0c3a40c5f58dbabeaf7ca3c9fc36010000006b483045022100c411133448b5f0deb9c12b408ff8a43ef8d78c06d6e9bac4988ef3deb906f333022014acb93ceeb629fdfc4abf375a8dba752f6f884f5ce497d70cdda2ff5b985b0901210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff020eb90000000000001976a91435f9f21795eb25e7987a2a01ae4c8be8a1d9ca9c88ace8030000000000001976a914bed0c9ce985514c0c0958906c19b6aca6898783788ac00000000",
                "02000000056169d5d038b5f784db0892a333059680d52df3145c084e88a0fab4745a65a110010000006b483045022100d5e3f58480ac242018ecd9666ef51ae90c54569c05f9e90a5e79ea9127a6d60102205ad6255754061606ef4c83825524b652c171f80acdb3b00fb6cc7e7bd8aaede001210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff062e94599761951917b456421ce335f8feec81441d6dd86de38a0b50f40f51a7010000006b483045022100d7235e46d6a2deb8aa89224c65c108ce9a30ce0a160b7c79f51b76031b404087022006bd6f76d5f6287be4903a22e628a46fac913f0f92504fe7f590af07f27638be01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff3601a59de17b415a6a26b362d11c8b988f7f99aa3d9426a910bcfb1a46de4191010000006b483045022100bf5cec0445195247b4618c7ec2ae7dfcf2c0be1011b357c71fd0ce146bdf2fba022041e7eba71977bb5ea3d3cfd5b9419d395ae650a1db7b3a147a9b7453e6ac6fd501210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff4bfda7f37c9754937a3ee51c33fa10b5a2921a91609c777ce6338b3469021d53010000006b4830450221008b5d6215b3b348fde53afecadf42d1508f3fc519267e695e452c7cfaebd373500220204c3bb05a08f6116d96c45b8b3de4496501d051c3aa287f74793217d6ee056601210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffffc32fbba18c86c875e042613aa057ff85c73d0c3a40c5f58dbabeaf7ca3c9fc36010000006a4730440220693cfc675ce08defe3e3b2dc5ba4f571398ffd8f0dfa4ab7e9b855590a10e007022011c127bb0fb238c44259536c3ced323bbe62bbe64d78836d01b8744f699b118a01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff020eb90000000000001976a91435f9f21795eb25e7987a2a01ae4c8be8a1d9ca9c88ace8030000000000001976a914bed0c9ce985514c0c0958906c19b6aca6898783788ac00000000",
                "02000000026169d5d038b5f784db0892a333059680d52df3145c084e88a0fab4745a65a110010000006b48304502210099d7e39dbabe22daa434ace0fcab8582c8dbd0fde0a4d859abe389ab8656cbbc022060584aa552ade3e8d9a04a6787f5c607fa031fa1b82fa19e5f534f7b93889d4f01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff062e94599761951917b456421ce335f8feec81441d6dd86de38a0b50f40f51a7010000006b483045022100dbb3df16091aade79773e59e4de39db4091ecba681a68b304c02dabafeab4d05022027e57c89ad7d3ec570771122fa23c55c517401f851e95a87db2e6c36e3b8e47c01210264ae7fbdd87c8283d885b7452322c448989907a5a79209cf5b40cd897dea1446ffffffff0256470000000000001976a91435f9f21795eb25e7987a2a01ae4c8be8a1d9ca9c88ace8030000000000001976a914bed0c9ce985514c0c0958906c19b6aca6898783788ac00000000"];
    wallet.loadFromFile('encryption key').then(()=>{
        wallet.discoverMsg().then(async () => {
            wallet.account.nextChainAddress(1);
            while(wallet.account.getChain(0).k < wallet.account.getChain(1).k){
                wallet.account.nextChainAddress(0);
            }
            var from="1CqzggZ1dwMgPW4iKHggwbLEh7pEV2rEu5";
            var messageHandler = new MessageHandler();
        
        
            txhash.forEach(hash => {
                var kArray = wallet.getK(from, hash);
                console.log(kArray)
                kArray.forEach(k=>{
                    messageHandler.receiveMessage(new BN(k, 16))
                })
            })
            messageHandler.recoverData();
            messageHandler.printMessage();     
        })
        
    })
}

// testWalletBuild()
testWalletRecover();
